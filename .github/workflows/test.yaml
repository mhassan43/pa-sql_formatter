name: probably not gonna work
on: [push]
jobs:
  sql-formatter:
    runs-on: ubuntu-latest
    steps:
     - name: Checkout the repository
       uses: actions/checkout@v2
       with:
         ref: ${{ github.ref }}
         fetch-depth: 0   

     - name: download and unzip // might download everytime its run.
       run: |
         wget https://github.com/Matts966/zetasql-formatter/releases/latest/download/zetasql-formatter_linux_x86_64.zip && sudo unzip zetasql-formatter_linux_x86_64.zip -d /usr/local/bin
     #- name: update
     #  run: |
     #     sudo apt-get install apt-transport-https curl gnupg
     #     curl -fsSL https://bazel.build/bazel-release.pub.gpg | gpg --dearmor > bazel.gpg
     #     sudo mv bazel.gpg /etc/apt/trusted.gpg.d/
     #     echo "deb [arch=amd64] https://storage.googleapis.com/bazel-apt stable jdk1.8" | sudo tee /etc/apt/sources.list.d/bazel.list
     #     sudo apt-get update
     #     sudo apt-get install --no-install-recommends -y gcc-9 g++-9
     #     sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-9 900 \
     #       --slave /usr/bin/g++ g++ /usr/bin/g++-9
     #     touch WORKSPACE
     #     bazelisk test --test_output=errors /usr/local/bin/zetasql-formatter:sql_formatter_test
     #     bazelisk build /usr/local/bin/zetasql-formatter/tools/zetasql-formatter:format 
     #     sudo cp bazel-bin/zetasql/tools/zetasql-formatter/format zetasql-formatter
     #     zip zetasql-formatter_linux_x86_64.zip zetasql-formatter
     - name: Test
       run: |
         echo "Insert into PA_CLIENT.TEXT_BLOCK (TEXT_BLOCK_ID,TITLE,FIRM_ID,SCHEME_ID,TEXT_BLOCK_MESSAGE,STATUS,CREATED,UPDATED,CREATED_BY,UPDATED_BY,LANGUAGE_ID,ORDERING,SYMBOL,ACTION,ACTION_ID) values (190,'Query for updating QUANTITY field for PA_CLIENT.TRANSACTION_BASE for transaction fixup','7673',542,'update pa_client.transaction_base pt set pt.quantity = pt.quantity / decode((select psec.quantity_multiple from pa_client.security psec, pa_client.firm paf where psec.security_id = pt.security_id and psec.security_profile_id = paf.security_profile_id and paf.firm_id = pt.broker_id), null,1, 0,1, (select psec.quantity_multiple from pa_client.security psec, pa_client.firm paf where psec.security_id = pt.security_id and psec.security_profile_id = paf.security_profile_id and paf.firm_id = pt.broker_id)) where pt.broker_id = :FIRM_ID','A',to_date('06-DEC-18','DD-MON-RR'),to_date('21-JUL-20','DD-MON-RR'),-1,-1,null,1110,'fixTransQuantity','process_fixup_queries',null);" | zetasql-formatter 
     - name: Release
       uses: softprops/action-gh-release@v1
       if: startsWith(github.ref, 'refs/tags/')
       with:
         files: zetasql-formatter_linux_x86_64.zip
         prerelease: true
         generate_release_notes: true
          
          
          
          
#echo "select * from test" | zetasql-formatter
#zetasql-formatter > formated.txt
#cat formated.txt
#bazelisk test --test_output=errors //zetasql/public:sql_formatter_test  
#bazelisk build //zetasql/tools/zetasql-formatter:format 
         
     
     
